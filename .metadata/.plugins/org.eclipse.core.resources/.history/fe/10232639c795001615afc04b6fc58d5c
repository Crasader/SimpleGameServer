package com.wq.gameServer.service;

import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.After;
import org.aspectj.lang.annotation.AfterReturning;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Aspect
public class LogService extends AbstractService{

	Logger logger = LoggerFactory.getLogger("Logger");
	
	@Pointcut("execution(* com.wq.gameServer.service.*.*(..))")
	public void serviceAspect(){
		
	}
	
	@Before("serviceAspect()")
	public void before(JoinPoint joinPoint){
		logger.debug("[Before]"+joinPoint.getTarget()+" : "+joinPoint.toShortString());
		Object[] args = joinPoint.getArgs();
		for(Object arg : args){
			logger.debug("[arg]"+arg);
		}
	}
	
	@After("serviceAspect()")
	public void after(JoinPoint joinPoint){
		logger.debug("[After]"+joinPoint.getTarget()+" : "+joinPoint.toShortString());
	}
	
	@AfterReturning(pointcut="serviceAspect()",returning="result")
	public void afterReturning(JoinPoint joinPoint, Object result){
		if(result != null){
			logger.debug("[Return]"+result);
		}
	}
	
	@Around("serviceAspect()")
	public void around(JoinPoint joinPoint){
		try{
			((ProceedingJoinPoint)joinPoint).proceed();
		}catch(Throwable e){
			logger.error(joinPoint.getTarget()+" : "+e.getMessage());
		} 
	}
}
